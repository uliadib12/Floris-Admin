import"./onInit.tzFMZM2B.js";class m{id;name;variants;images;description;constructor({id:e=0,name:i="",variants:t=[],images:n=[],description:s=""}){this.id=e,this.name=i,this.variants=t,this.images=n,this.description=s}}class u{name;price;stock;size;constructor({name:e="",price:i=0,stock:t=0,size:n=""}){this.name=e,this.price=i,this.stock=t,this.size=n}}f();async function f(){const a=await b();g(a),p()}async function b(){const e=await(await fetch(`https://floris-backend-fqzecn2umq-uc.a.run.app/api/v1/category/${c()}`)).json();console.log(e);const i=[];return e.forEach(t=>{t=new m({id:t.id,name:t.name,description:t.description,images:t.images,variants:t.variants}),i.push(t)}),i}function g(a){const i=$("#dataTable")[0].tBodies[0];a.forEach(t=>{const n=i.insertRow();n.insertCell().innerText=t.id.toString(),n.insertCell().innerText=t.name,n.insertCell().innerHTML=h(t.id,t.variants).map(s=>s.outerHTML).join("<br><br>"),n.insertCell().innerHTML=A(t.id,t.images).map(s=>s.outerHTML).join("<br><br>"),n.insertCell().innerText=t.description}),v(),x()}function p(){$("#content-category")[0].classList.remove("invisible")}function h(a,e){const i=[];return e.forEach(t=>{const n=document.createElement("button");n.classList.add("btn","btn-primary","btn-sm","button-edit-variant"),n.innerText=t.name,n.setAttribute("data-id",a.toString()),n.setAttribute("data-variantIndex",e.indexOf(t).toString()),n.setAttribute("data-variant",JSON.stringify(t)),n.setAttribute("data-toggle","modal"),n.setAttribute("data-target","#modalEditVariant"),i.push(n)}),i}function v(){const a=$(".button-edit-variant"),e=$("#modalEditVariant");a.each((i,t)=>{t.addEventListener("click",()=>{const n=JSON.parse(t.getAttribute("data-variant")??"{}"),s=t.getAttribute("data-id"),o=t.getAttribute("data-variantIndex");e.find("#id").val(s),e.find("#variantIndex").val(o),e.find("#name").val(n.name),e.find("#price").val(n.price),e.find("#stock").val(n.stock),e.find("#size").val(n.size)})})}function A(a,e){const i=[];return e.forEach(t=>{const n=document.createElement("button");n.classList.add("btn","btn-primary","btn-sm","button-edit-image"),n.innerText="Image"+(e.indexOf(t)+1),n.setAttribute("data-id",a.toString()),n.setAttribute("data-imageIndex",e.indexOf(t).toString()),n.setAttribute("data-image",t),n.setAttribute("data-toggle","modal"),n.setAttribute("data-target","#modalImage"),i.push(n)}),i}function x(){const a=$(".button-edit-image"),e=$("#modalImage");a.each((i,t)=>{t.addEventListener("click",()=>{const n=t.getAttribute("data-image"),s=t.getAttribute("data-id"),o=t.getAttribute("data-imageIndex");e.find("#id").val(s),e.find("#imageIndex").val(o);const r=e.find("#image")[0];r.src=n??""})})}function T(){const a=$("#add-variant")[0],e=$("#modalAddVariant"),t=$("#modalAdd").find("#dataTableVariant")[0];a.addEventListener("click",()=>{const n=e.find("#name")[0],s=e.find("#price")[0],o=e.find("#stock")[0],r=e.find("#size")[0],d=t.tBodies[0].insertRow();d.insertCell().innerText=n.value,d.insertCell().innerText=s.value,d.insertCell().innerText=o.value,d.insertCell().innerText=r.value,e.modal("hide")})}T();function w(){const a=$("#modalAdd");a.on("show.bs.modal",()=>{const i=a.find("#dataTableVariant")[0].tBodies[0];for(;i.firstChild;)i.removeChild(i.firstChild);a.find("#form-add-product")[0].reset()})}w();function C(){const a=$("#modalAdd");a.find("#add-product")[0].addEventListener("click",()=>{const i=a.find("#images")[0],t=a.find("#name")[0],n=a.find("#description")[0],s=k(),o={images:i.files,name:t.value,description:n.value,variants:s};I(o)})}function c(){return new URLSearchParams(window.location.search).get("name")}async function I(a){const e=[];for(let t=0;t<a.images.length;t++){const n=a.images?.item(t);if(n){const s=await new Promise((o,r)=>{const d=new FileReader;d.readAsDataURL(n),d.onload=()=>o(d.result),d.onerror=l=>r(l)});e.push(s)}}(await fetch(`https://floris-backend-fqzecn2umq-uc.a.run.app/api/v1/category/${c()}/add-product`,{method:"POST",body:new URLSearchParams({name:a.name,description:a.description,images:JSON.stringify(e),variants:JSON.stringify(a.variants)}),headers:{"Content-Type":"application/x-www-form-urlencoded"}})).status===200?(alert("Success"),window.location.reload()):alert("Failed")}C();function k(){const e=$("#dataTableVariant")[0].tBodies[0],i=[];return e.childNodes.forEach(t=>{const n=new u({name:t.childNodes[0].innerText,price:parseInt(t.childNodes[1].innerText),stock:parseInt(t.childNodes[2].innerText),size:t.childNodes[3].innerText});i.push(n)}),i}

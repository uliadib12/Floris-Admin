import"./onInit.tzFMZM2B.js";class m{id;name;variants;images;description;constructor({id:n=0,name:i="",variants:t=[],images:e=[],description:o=""}){this.id=n,this.name=i,this.variants=t,this.images=e,this.description=o}}class u{name;price;stock;size;constructor({name:n="",price:i=0,stock:t=0,size:e=""}){this.name=n,this.price=i,this.stock=t,this.size=e}}b();async function b(){const a=await f();p(a),g()}async function f(){const n=await(await fetch(`https://floris-backend-fqzecn2umq-uc.a.run.app/api/v1/category/${c()}`)).json(),i=[];return n.forEach(t=>{t=new m({id:t.id,name:t.name,description:t.description,images:t.images,variants:t.variants}),i.push(t)}),i}function p(a){const i=$("#dataTable")[0].tBodies[0];a.forEach(t=>{const e=i.insertRow();e.insertCell().innerText=t.id.toString(),e.insertCell().innerText=t.name,e.insertCell().innerHTML=h(t.id,t.variants).map(o=>o.outerHTML).join("<br><br>"),e.insertCell().innerHTML=T(t.id,t.images).map(o=>o.outerHTML).join("<br><br>"),e.insertCell().innerText=t.description,e.insertCell().innerHTML=`<button class="btn btn-danger btn-sm" data-toggle="modal" data-target="#modalDelete" data-id="${t.id}">Delete</button>`}),v(),A()}function g(){$("#content-category")[0].classList.remove("invisible")}function h(a,n){const i=[];return n.forEach(t=>{const e=document.createElement("button");e.classList.add("btn","btn-primary","btn-sm","button-edit-variant"),e.innerText=t.name,e.setAttribute("data-id",a.toString()),e.setAttribute("data-variantIndex",n.indexOf(t).toString()),e.setAttribute("data-variant",JSON.stringify(t)),e.setAttribute("data-toggle","modal"),e.setAttribute("data-target","#modalEditVariant"),i.push(e)}),i}function v(){const a=$(".button-edit-variant"),n=$("#modalEditVariant");a.each((i,t)=>{t.addEventListener("click",()=>{const e=JSON.parse(t.getAttribute("data-variant")??"{}"),o=t.getAttribute("data-id"),d=t.getAttribute("data-variantIndex");n.find("#id").val(o),n.find("#variantIndex").val(d),n.find("#name").val(e.name),n.find("#price").val(e.price),n.find("#stock").val(e.stock),n.find("#size").val(e.size)})})}function T(a,n){const i=[];return n.forEach(t=>{const e=document.createElement("button");e.classList.add("btn","btn-primary","btn-sm","button-edit-image"),e.innerText="Image"+(n.indexOf(t)+1),e.setAttribute("data-id",a.toString()),e.setAttribute("data-imageIndex",n.indexOf(t).toString()),e.setAttribute("data-image",t),e.setAttribute("data-toggle","modal"),e.setAttribute("data-target","#modalImage"),i.push(e)}),i}function A(){const a=$(".button-edit-image"),n=$("#modalImage");a.each((i,t)=>{t.addEventListener("click",()=>{const e=t.getAttribute("data-image"),o=t.getAttribute("data-id"),d=t.getAttribute("data-imageIndex");n.find("#id").val(o),n.find("#imageIndex").val(d);const r=n.find("#image")[0];r.src=e??""})})}function w(){const a=$("#add-variant")[0],n=$("#modalAddVariant"),t=$("#modalAdd").find("#dataTableVariant")[0];a.addEventListener("click",()=>{const e=n.find("#name")[0],o=n.find("#price")[0],d=n.find("#stock")[0],r=n.find("#size")[0],s=t.tBodies[0].insertRow();s.insertCell().innerText=e.value,s.insertCell().innerText=o.value,s.insertCell().innerText=d.value,s.insertCell().innerText=r.value,n.modal("hide")})}w();function x(){const a=$("#modalAdd");a.on("show.bs.modal",()=>{const i=a.find("#dataTableVariant")[0].tBodies[0];for(;i.firstChild;)i.removeChild(i.firstChild);a.find("#form-add-product")[0].reset()})}x();function C(){const a=$("#modalAdd");a.find("#add-product")[0].addEventListener("click",()=>{const i=a.find("#images")[0],t=a.find("#name")[0],e=a.find("#description")[0],o=I(),d={images:i.files,name:t.value,description:e.value,variants:o};k(d)})}function c(){return new URLSearchParams(window.location.search).get("name")}async function k(a){const n=[];for(let t=0;t<a.images.length;t++){const e=a.images?.item(t);if(e){const o=await new Promise((d,r)=>{const s=new FileReader;s.readAsDataURL(e),s.onload=()=>d(s.result),s.onerror=l=>r(l)});n.push(o)}}(await fetch(`https://floris-backend-fqzecn2umq-uc.a.run.app/api/v1/category/${c()}/add-product`,{method:"POST",body:new URLSearchParams({name:a.name,description:a.description,images:JSON.stringify(n),variants:JSON.stringify(a.variants)}),headers:{"Content-Type":"application/x-www-form-urlencoded"}})).status===200?(alert("Success"),window.location.reload()):alert("Failed")}C();function I(){const n=$("#dataTableVariant")[0].tBodies[0],i=[];return n.childNodes.forEach(t=>{const e=new u({name:t.childNodes[0].innerText,price:parseInt(t.childNodes[1].innerText),stock:parseInt(t.childNodes[2].innerText),size:t.childNodes[3].innerText});i.push(e)}),i}function S(){$("#modalDelete").on("show.bs.modal",n=>{const t=n.relatedTarget.getAttribute("data-id");$("#modalDelete").find("#id").val(t)})}S();function L(){const a=$("#modalDelete");a.find("#delete-product")[0].addEventListener("click",()=>{const i=a.find("#id")[0];E(i.value)})}L();async function E(a){(await fetch(`https://floris-backend-fqzecn2umq-uc.a.run.app/api/v1/category/${c()}/delete-product`,{method:"DELETE",body:new URLSearchParams({id:a})})).status===200?(alert("Success"),window.location.reload()):alert("Failed")}
